# 更新日志

## 2025-01-30 - 重大更新

### ✨ 新增功能

#### 1. ZIP下载功能（推荐）
- **功能描述**：所有下载现在都会自动打包成ZIP文件，直接下载到用户本地
- **优势**：
  - 不占用服务器存储空间
  - 适合 Fly.io 等临时文件系统的部署环境
  - 方便管理和分享
- **使用方法**：
  - 单个笔记：预览弹窗 → 选择图片 → 点击"下载" → 自动下载ZIP
  - 批量下载：批量选中 → 一键下载 → 依次下载多个ZIP文件
- **ZIP内容**：
  - `笔记标题.txt` - 包含标题、正文、标签、来源链接
  - `image_1.jpg`, `image_2.png` ... - 选中的图片

#### 2. Fly.io 部署支持
- **功能描述**：后端已配置支持部署到 Fly.io（免费额度 + 自动停机）
- **配置文件**：
  - `backend/Dockerfile` - Docker 镜像配置（包含 Playwright Chromium）
  - `fly.toml` - Fly.io 部署配置（自动停机、高可用）
- **部署步骤**：详见 [FLY_DEPLOY.md](./FLY_DEPLOY.md)
- **自动停机**：已配置 `min_machines_running = 0`，空闲时自动停止节省额度

#### 3. 图标选择功能
- **功能描述**：提供了 8 个不同风格的图标供选择
- **图标选项**：
  - 选项1-3：小红书风格（红色主题）
  - 选项4-8：硅谷风格（简约大方，无XHS字样）
- **预览方式**：访问 `http://localhost:3000/icon-preview.html`
- **当前应用**：选项1（现代简约风格）

#### 4. 右键粘贴支持
- **功能描述**：链接解析区域现在支持右键菜单粘贴
- **支持方式**：
  - Ctrl+V 快捷键粘贴
  - 右键菜单粘贴
  - 自动提取粘贴文本中的链接

#### 5. 文件夹选择功能（已移除UI）
- **说明**：由于改为ZIP直接下载，已移除"保存到文件夹"相关UI
- **保留**：后端接口仍保留，供本地开发使用

### 🔧 技术改进

1. **后端API优化**：
   - 新增 `/api/download_zip` 接口（ZIP下载）
   - 保留 `/api/selective_download` 接口（兼容旧版）
   - 优化错误处理和响应格式

2. **前端优化**：
   - 优化下载逻辑，支持ZIP文件下载
   - 改进批量下载体验（添加延迟避免浏览器阻止）
   - 移除不再需要的文件夹选择UI

3. **部署优化**：
   - Dockerfile 优化，支持 Fly.io 部署
   - 自动安装 Playwright Chromium
   - 配置自动停机节省资源

### 📝 文档更新

- ✅ 更新 `README.md` - 添加最新功能说明
- ✅ 更新 `FLY_DEPLOY.md` - 添加部署详细步骤
- ✅ 新增 `ICON_SELECTION.md` - 图标选择指南
- ✅ 新增 `CHANGELOG.md` - 更新日志（本文件）

### 🐛 Bug修复

1. 修复文件夹选择器错误处理
2. 修复下载文件名特殊字符处理
3. 优化错误提示信息

### 📦 依赖更新

- 后端：无需新增依赖（使用标准库 `zipfile` 和 `io`）
- 前端：无需新增依赖

---

## 使用建议

### 生产环境部署

1. **前端（Vercel）**：
   - 设置环境变量：`NEXT_PUBLIC_BACKEND_URL = https://your-fly-app.fly.dev`
   - 重新部署

2. **后端（Fly.io）**：
   - 运行 `flyctl deploy` 部署
   - 验证：访问 `https://your-app.fly.dev/docs`

### 本地开发

- 所有功能在本地开发环境同样可用
- ZIP下载功能在本地和云端都正常工作

---

**提示**：如有问题或需要帮助，请查看相关文档或联系开发者。
